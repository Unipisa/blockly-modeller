<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Blockly ModeLLer</title>
</head>

<body>
  <div id="pageContainer">
    <div id="blocklyDiv">
      <input id="customTitle" type='text' placeholder='Insert title...' style="font-family: Helvetica" />
    </div>
    <div id="outputPane">
      <h3 style="font-family: Helvetica" , id="codeTitle">UML model (XMI)</h3>
      <img id="generatedCode" style="max-width: 378px;padding-left: 2px;max-height: 240px;padding-right: 17px;" />
      <h3 style="font-family: Helvetica" , id="reportTitle">Report</h3>
      <div id="schemeReport">
        <div id="txtReport"></div>
        <textarea id="comment" rows="2" cols="46" placeholder='Add comment to report (optional)...'></textarea>
      </div>
      <div id="buttonArea">
        <input type="hidden" id="xmiData" value="" />
        <input type="hidden" id="plantUML" value="" />
        <button id="downloadButton" class="button-13" onclick="downloadFile()"> .xmi file</button>
        <script>
          const downloadFile = () => {
            const link = document.createElement("a");
            const content = document.getElementById("xmiData").value;
            const title = document.getElementById("customTitle");

            // get date
            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0
            var yyyy = today.getFullYear();
            today = dd + '-' + mm + '-' + yyyy;

            const file = new Blob([content], { type: 'text/xml' });
            link.href = URL.createObjectURL(file);
            link.download = `${today}_diagramUML_${title.value}.xmi`;
            link.click();
            URL.revokeObjectURL(link.href);
          };
        </script>
        <button id="downloadButton" class="button-13" onclick="downloadReport()">Report file</button>
        <script>
          const downloadReport = () => {
            const link = document.createElement("a");
            const comment = document.getElementById("comment");
            var textComment = new String();
            if (comment.value != '') {
              textComment = '\nNOTES: ' + comment.value;
            }
            const content = document.getElementById("txtReport").innerText;
            const title = document.getElementById("customTitle");

            // get date
            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0
            var yyyy = today.getFullYear();
            today = dd + '-' + mm + '-' + yyyy;

            const file = new Blob([content, textComment], { type: 'text/xml' });
            link.href = URL.createObjectURL(file);
            link.download = `${today}_diagramREPORT_${title.value}.txt`;
            link.click();
            URL.revokeObjectURL(link.href);
          };
        </script>
        <button id="downloadPlantUML" class="button-13" onclick="downloadPlantUML()">PlantUML file</button>
        <script>
          const downloadPlantUML = () => {
            const link = document.createElement("a");
            const comment = document.getElementById("comment");
            var textComment = new String();
            if (comment.value != '') {
              textComment = '\nNOTES: ' + comment.value;
            }
            const content = document.getElementById("plantUML").value;
            const title = document.getElementById("customTitle");

            // get date
            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0
            var yyyy = today.getFullYear();
            today = dd + '-' + mm + '-' + yyyy;

            const file = new Blob([content, textComment], { type: 'text/xml' });
            link.href = URL.createObjectURL(file);
            link.download = `${today}_diagramPlantUML_${title.value}.txt`;
            link.click();
            URL.revokeObjectURL(link.href);
          };
        </script>
        <a href="#" id="downloadUML" target="_blank" download="download" class="button-13">View Diagram</button>

      </div>
      <div id="output"></div>
    </div>
  </div>
</body>

</html>